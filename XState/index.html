<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="ie=edge"/><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"/><style data-href="/tech-share/styles.e7a13cbcedd535ab3165.css" data-identity="gatsby-global-css">:root{--reach-skip-nav:1}[data-reach-skip-nav-link]{clip:rect(0 0 0 0);border:0;height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px}[data-reach-skip-nav-link]:focus{clip:auto;background:#fff;height:auto;left:10px;padding:1rem;position:fixed;top:10px;width:auto;z-index:1}</style><meta name="generator" content="Gatsby 3.14.2"/><style>.gatsby-image-wrapper{position:relative;overflow:hidden}.gatsby-image-wrapper img{bottom:0;height:100%;left:0;margin:0;max-width:none;padding:0;position:absolute;right:0;top:0;width:100%;object-fit:cover}.gatsby-image-wrapper [data-main-image]{opacity:0;transform:translateZ(0);transition:opacity .25s linear;will-change:opacity}.gatsby-image-wrapper-constrained{display:inline-block;vertical-align:top}</style><noscript><style>.gatsby-image-wrapper noscript [data-main-image]{opacity:1!important}.gatsby-image-wrapper [data-placeholder-image]{opacity:0!important}</style></noscript><script type="module">const e="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;e&&document.body.addEventListener("load",(function(e){if(void 0===e.target.dataset.mainImage)return;if(void 0===e.target.dataset.gatsbyImageSsr)return;const t=e.target;let a=null,n=t;for(;null===a&&n;)void 0!==n.parentNode.dataset.gatsbyImageWrapper&&(a=n.parentNode),n=n.parentNode;const o=a.querySelector("[data-placeholder-image]"),r=new Image;r.src=t.currentSrc,r.decode().catch((()=>{})).then((()=>{t.style.opacity=1,o&&(o.style.opacity=0,o.style.transition="opacity 500ms linear")}))}),!0);</script><title data-react-helmet="true">XState | Tech Sharing</title><meta data-react-helmet="true" name="description" content="JavaScript state machines and statecharts."/><meta data-react-helmet="true" property="og:title" content="XState"/><meta data-react-helmet="true" property="og:description" content="JavaScript state machines and statecharts."/><meta data-react-helmet="true" property="og:type" content="website"/><meta data-react-helmet="true" name="twitter:creator" content="Hchyeria"/><meta data-react-helmet="true" name="twitter:title" content="XState"/><meta data-react-helmet="true" name="twitter:description" content="JavaScript state machines and statecharts."/><meta data-react-helmet="true" name="twitter:card" content="summary"/><link as="script" rel="preload" href="/tech-share/webpack-runtime-0d982ec01d78325662b2.js"/><link as="script" rel="preload" href="/tech-share/framework-50e1fed84a2b384cae09.js"/><link as="script" rel="preload" href="/tech-share/app-0757bd07aa19d9a578e2.js"/><link as="script" rel="preload" href="/tech-share/commons-336c928a835dd092a474.js"/><link as="script" rel="preload" href="/tech-share/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-1634ccf660e032cc27bb.js"/><link as="fetch" rel="preload" href="/tech-share/page-data/XState/page-data.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/tech-share/page-data/sq/d/2744905544.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/tech-share/page-data/sq/d/3090755652.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/tech-share/page-data/sq/d/3308536712.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/tech-share/page-data/sq/d/764694655.json" crossorigin="anonymous"/><link as="fetch" rel="preload" href="/tech-share/page-data/app-data.json" crossorigin="anonymous"/></head><body><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.documentElement.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><script>(function() { try {
  var mode = localStorage.getItem('theme-ui-color-mode');
  if (!mode) return
  document.documentElement.classList.add('theme-ui-' + mode);
  document.body.classList.add('theme-ui-' + mode);
} catch (e) {} })();</script><div id="___gatsby"><style data-emotion="css-global fzrfe3">body{--theme-ui-colors-text:#232129;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#7cadda;--theme-ui-colors-secondary:#1B1F23;--theme-ui-colors-muted:hsla(0, 0%, 0%, 0.2);--theme-ui-colors-highlight:rgba(255, 229, 100, 0.2);--theme-ui-colors-heading:#232129;--theme-ui-colors-prism-background:#011627;--theme-ui-colors-prism-comment:#809393;--theme-ui-colors-prism-string:#addb67;--theme-ui-colors-prism-var:#d6deeb;--theme-ui-colors-prism-number:#f78c6c;--theme-ui-colors-prism-constant:#82aaff;--theme-ui-colors-prism-punctuation:#c792ea;--theme-ui-colors-prism-className:#ffc98b;--theme-ui-colors-prism-tag:#ffa7c4;--theme-ui-colors-prism-boolean:#ff5874;--theme-ui-colors-prism-property:#80cbc4;--theme-ui-colors-prism-namespace:#b2ccd6;--theme-ui-colors-prism-highlight:hsla(207, 95%, 15%, 1);color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}body.theme-ui-dark{--theme-ui-colors-text:rgba(255, 255, 255, 0.86);--theme-ui-colors-background:#232129;--theme-ui-colors-primary:#D9BAE8;--theme-ui-colors-secondary:rgba(255, 255, 255, 0.86);--theme-ui-colors-muted:hsla(0, 0%, 100%, 0.2);--theme-ui-colors-highlight:#663399;--theme-ui-colors-heading:#fff;}</style><style data-emotion="css-global 8ir1vi">*{box-sizing:border-box;}body{margin:0;font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;}</style><style data-emotion="css-global ndrc34">html{--theme-ui-colors-text:#232129;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#7cadda;--theme-ui-colors-secondary:#1B1F23;--theme-ui-colors-muted:hsla(0, 0%, 0%, 0.2);--theme-ui-colors-highlight:rgba(255, 229, 100, 0.2);--theme-ui-colors-heading:#232129;--theme-ui-colors-prism-background:#011627;--theme-ui-colors-prism-comment:#809393;--theme-ui-colors-prism-string:#addb67;--theme-ui-colors-prism-var:#d6deeb;--theme-ui-colors-prism-number:#f78c6c;--theme-ui-colors-prism-constant:#82aaff;--theme-ui-colors-prism-punctuation:#c792ea;--theme-ui-colors-prism-className:#ffc98b;--theme-ui-colors-prism-tag:#ffa7c4;--theme-ui-colors-prism-boolean:#ff5874;--theme-ui-colors-prism-property:#80cbc4;--theme-ui-colors-prism-namespace:#b2ccd6;--theme-ui-colors-prism-highlight:hsla(207, 95%, 15%, 1);color:var(--theme-ui-colors-text);background-color:var(--theme-ui-colors-background);}html.theme-ui-light,.theme-ui-light html{--theme-ui-colors-text:#232129;--theme-ui-colors-background:#fff;--theme-ui-colors-primary:#7cadda;--theme-ui-colors-secondary:#1B1F23;--theme-ui-colors-muted:hsla(0, 0%, 0%, 0.2);--theme-ui-colors-highlight:rgba(255, 229, 100, 0.2);--theme-ui-colors-heading:#232129;--theme-ui-colors-prism-background:#011627;--theme-ui-colors-prism-comment:#809393;--theme-ui-colors-prism-string:#addb67;--theme-ui-colors-prism-var:#d6deeb;--theme-ui-colors-prism-number:#f78c6c;--theme-ui-colors-prism-constant:#82aaff;--theme-ui-colors-prism-punctuation:#c792ea;--theme-ui-colors-prism-className:#ffc98b;--theme-ui-colors-prism-tag:#ffa7c4;--theme-ui-colors-prism-boolean:#ff5874;--theme-ui-colors-prism-property:#80cbc4;--theme-ui-colors-prism-namespace:#b2ccd6;--theme-ui-colors-prism-highlight:hsla(207, 95%, 15%, 1);}html.theme-ui-dark,.theme-ui-dark html{--theme-ui-colors-text:rgba(255, 255, 255, 0.86);--theme-ui-colors-background:#232129;--theme-ui-colors-primary:#D9BAE8;--theme-ui-colors-secondary:rgba(255, 255, 255, 0.86);--theme-ui-colors-muted:hsla(0, 0%, 100%, 0.2);--theme-ui-colors-highlight:#663399;--theme-ui-colors-heading:#fff;}</style><style data-emotion="css-global p0tn04">*{box-sizing:border-box;}html{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;}body{margin:0;}</style><div style="outline:none" tabindex="-1" id="gatsby-focus-wrapper"><style data-emotion="css ocpejr">.css-ocpejr{font-family:system-ui,-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;}</style><div class="css-ocpejr"><header><style data-emotion="css 166tr3t">.css-166tr3t{color:var(--theme-ui-colors-primary);}</style><a class="css-166tr3t" href="#reach-skip-nav" data-reach-skip-link="" data-reach-skip-nav-link="">Skip to content</a><style data-emotion="css 1a161fb">.css-1a161fb{max-width:672px;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:32px;}</style><div class="css-1a161fb"><style data-emotion="css fplwad">.css-fplwad{display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;-webkit-box-pack:justify;-webkit-justify-content:space-between;justify-content:space-between;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;margin-bottom:32px;}</style><div class="css-fplwad"><style data-emotion="css 1qvw5n7">.css-1qvw5n7{margin-top:0;margin-bottom:0;}</style><style data-emotion="css 61js37">.css-61js37{margin-top:0;margin-bottom:0;}</style><p class="css-61js37"><style data-emotion="css 2ifw1d">.css-2ifw1d{box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary);}</style><style data-emotion="css 1awiyq">.css-1awiyq{color:var(--theme-ui-colors-primary);box-shadow:none;-webkit-text-decoration:none;text-decoration:none;color:var(--theme-ui-colors-primary);}</style><a class="css-1awiyq" href="/tech-share/">Tech Sharing</a></p></div></div></header><div id="reach-skip-nav" data-reach-skip-nav-content=""></div><div><style data-emotion="css 1in33uw">.css-1in33uw{max-width:672px;margin-left:auto;margin-right:auto;padding-left:16px;padding-right:16px;padding-top:32px;padding-bottom:32px;}</style><div class="css-1in33uw"><main><article><header><h1 class="css-0">XState</h1><style data-emotion="css rsra4b">.css-rsra4b{font-size:14px;margin-top:-16px;margin-bottom:16px;}</style><style data-emotion="css 1jnjfic">.css-1jnjfic{font-size:14px;margin-top:-16px;margin-bottom:16px;}.css-1jnjfic code{font-size:inherit;}</style><p class="css-1jnjfic">October 10, 2021</p></header><section><style data-emotion="css 1vei6m9">.css-1vei6m9 code{font-size:inherit;}.css-1vei6m9 code{font-size:inherit;}</style><p class="css-1vei6m9">Developing user interfaces <strong class="css-0">is not easy</strong>.</p><p class="css-1vei6m9">I’m going to start with a post from <style data-emotion="css 1nubre7">.css-1nubre7{color:var(--theme-ui-colors-primary);color:var(--theme-ui-colors-primary);}</style><a href="https://dev.to/davidkpiano/no-disabling-a-button-is-not-app-logic-598i" class="css-1nubre7"><em class="css-0">No, disabling a button is not app logic</em></a> writted by <em class="css-0">David K</em>. in 2019 to introduce what’s the XState and what can we use it to do.
A book <em class="css-0">Constructing the User Interface with Statecharts</em>, written by <em class="css-0">Ian Horrocks</em> in 1999 said:</p><style data-emotion="css 34uy4p">.css-34uy4p{color:inherit;border-left-color:inherit;opacity:0.8;color:inherit;border-left-color:inherit;opacity:0.8;}.css-34uy4p.translation{font-size:1em;}.css-34uy4p.translation{font-size:1em;}</style><blockquote class="css-34uy4p"><p class="css-1vei6m9">User interface development tools are very powerful. They can be used to construct large and complex user interfaces, with only a relatively small amount of code written by an application developer. And yet, despite the power of such tools and the relatively small amount of code that is written, user interface software often has the following characteristics:
the code can be difficult to understand and review thoroughly:
the code can be difficult to test in a systematic and thorough way;
the code can contain bugs even after extensive testing and bug fixing;
the code can be difficult to enhance without introducing unwanted side-effects;
the quality of the code tends to deteriorate as enhancements are made to it.
Despite the obvious problems associated with user interface development, <strong class="css-0">little effort has been made to improve the situation</strong>. Any practitioner who has worked on large user interface projects will be familiar with many of the above characteristics, which are <strong class="css-0">symptomatic of the way in which the software is constructed</strong>.</p></blockquote><p class="css-1vei6m9">This was written over 20 years ago and yet it echoes the same sentiments that many developers feel today about the state of app development. Why is that?</p><p class="css-1vei6m9">State Machines is not a new concept bing in UI development, you can see the post <a href="https://medium.com/@asolove/pure-ui-control-ac8d1be97a8d" class="css-1nubre7"><em class="css-0">Pure UI Control</em></a>, already have some thinkings.</p><style data-emotion="css 17gfwuz">.css-17gfwuz{pointer-events:painted;}.css-17gfwuz a{visibility:hidden;}.css-17gfwuz:hover a{visibility:visible;}</style><h3 id="finite-state-machines" class="css-17gfwuz"><style data-emotion="css yixlj4">.css-yixlj4{margin-left:-20px;padding-right:4px;color:var(--theme-ui-colors-primary);}</style><a href="#finite-state-machines" aria-label="Finite State Machines" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Finite State Machines</h3><p class="css-1vei6m9">The finite state machine is one of the oldest models of computation in computer science.
they are a visual and mathematical way of modeling stateful logic using 3 main building blocks:</p><ul class="css-0"><li class="css-1vei6m9"><strong class="css-0">Finite states,</strong> which represent different behaviors</li><li class="css-1vei6m9"><strong class="css-0">Events</strong>, which represent something that happened that can change state</li><li class="css-1vei6m9"><strong class="css-0">Transitions,</strong> which represent how the state can change and what actions are executed when an event is received</li></ul><p class="css-1vei6m9">Quick go through the mathematic of <a href="https://en.wikipedia.org/wiki/Finite-state_machine" class="css-1nubre7">Finite State Machines</a>.</p><p class="css-1vei6m9"><strong class="css-0">Next, we’ll explore this with a simple example: fetching data in a React component.</strong></p><p class="css-1vei6m9">In Finite State Machines, it’s look like:</p><p class="css-1vei6m9"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:628px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:44.05797101449275%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABLElEQVQoz31R23KsIBD0XbkTYVVkMbsmXpL//7tODYmGWKfOQ1cP0zMw9FRCCCilwDkHxSWklJlJK/X/1VZaayzLAmJKEpNgjDkLb7cbnHM5Z7SGtRaSNK2hrIEuavOF0zRhnmfs+46UUj5TTPx8PrGuK7Zty+f3ZcH++YHwmhCmhLdtRZju3xcKiYoCxhhijHg8HhiGIU90TDmOY9ame0IIAUJKcCFgXQvfd+hDgO+6nKepKxrzAE1LII9O/xhD0zRolQZv2K9Gvl78y18uE6fpxSIoZpxjcB73GOG9P5vLvnMp120RvH1B5zx679G3LZyx8Nbm79Ny/rXlA9U5yQ/Ih9E5pBiRxhFzP6DVOvtc13Xma0+JigoOUILYKpUvaY3OD9RN86ep7LniCxz63A0mFdqlAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="image-20211011024953642" title="image-20211011024953642" src="/tech-share/static/6b89e19834ed1c06a609636ef957a7a5/3d84d/image-20211011024953642.png" srcSet="/tech-share/static/6b89e19834ed1c06a609636ef957a7a5/e4d6b/image-20211011024953642.png 345w,/tech-share/static/6b89e19834ed1c06a609636ef957a7a5/3d84d/image-20211011024953642.png 628w" sizes="(max-width: 628px) 100vw, 628px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1vei6m9">Now I want to add some new features, I want to able to retry when error happen:</p><p class="css-1vei6m9"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:561px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:43.76811594202899%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABSUlEQVQoz21SbZuCIBD0a6VY8iaiSJ56nmX1///c3LN0ktfTh4FdYIfZgaQsSxwOBzDGAvI8R5ZlMaaZ8nVtjWkvZ/m/uuPxiGSeZzjn0LYtmqaB1hp934e4KAp470PedR2MMSH+maZwTpoS2tUw3kFoFUgTIpqmCff7PRAPwxBIaJ0uo/zxeGC53dAPA6xr0J496q8zmq8z5usV4/QNVZmnQlJBaqy1qKoKUsrYGtlxuVyglIKzNu4RqJhUcSXBpUTB+VPh6tnLG4ZlWQLoIs55IDBCYrfbRbKnh+yF1UMatqANIURoXyqF9O8BvK0xjiMqYyLpp9qgcAvFObQQqI2BkRKiKMKspQy+Uvvrq35CsnqSMYbidEKrNTrvMfQ9JtegryxOeR6U7vf7+GXWunck2yRjGUouYJVCJWXwLU3T+Afjubd8S/gLyqnfxqt0rqMAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="image-20211011025733789" title="image-20211011025733789" src="/tech-share/static/862b0b9eeaf0d2952317ac691afe34f5/410f3/image-20211011025733789.png" srcSet="/tech-share/static/862b0b9eeaf0d2952317ac691afe34f5/e4d6b/image-20211011025733789.png 345w,/tech-share/static/862b0b9eeaf0d2952317ac691afe34f5/410f3/image-20211011025733789.png 561w" sizes="(max-width: 561px) 100vw, 561px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1vei6m9">You may find there may not the only “REJECT” reason that can trigger error, “TIMEOUT” still need to be considerable:</p><p class="css-1vei6m9"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:570px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:46.3768115942029%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABTUlEQVQoz11S2Y6DMAzkfaGQhBwEcnBsS6mq/v/XzcrWpqJ9GGwcezKZpDLGYJom1HWNtm3fuFwuH3nTNO8axe/1klchBLxeL8QYkXNmOOewLAtoTWuNbdtwu924NgwDjuPgvLcGNkwYlwwbPDohUBE7EVyv13fjPM+smgj3fee1x+OB5/OJkCKc95hygl8y8rpiPw6MKUJIgapI9d4ziFwpxTWyIaWEddtgtYZ3jnvIJrKACJTREEpBKoWu61DRh0ANxSeKRdnoPZMrIWCU4k3cP3H75SUTnn8KitF+GCCEQN006KXEmjP2+51rpJI2JBvIZ+r/IDzf2GgM4jgih4BEarSG63u2goZpkC5HSsnk5/mqPIECOm6yFr85Y44RB8Vpwk/9w8clMjoykZ1tImKKVSme/ZNdh14IyLaF6XsM3rMygrWWlZT+MlPwB2Mz4LXJ7LrCAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="image-20211011025857123" title="image-20211011025857123" src="/tech-share/static/9ffd5856f1841e425f5da7e632a9b182/432e7/image-20211011025857123.png" srcSet="/tech-share/static/9ffd5856f1841e425f5da7e632a9b182/e4d6b/image-20211011025857123.png 345w,/tech-share/static/9ffd5856f1841e425f5da7e632a9b182/432e7/image-20211011025857123.png 570w" sizes="(max-width: 570px) 100vw, 570px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1vei6m9">When it comes to adding complexity and extending it with features, also be abled to describe it with your team members, designers and anyone interested with you app, have a visual model like this is actually very very helpful for us to organize our app’s logic and exactly know what’s going on.</p><h3 id="demo-dogfetcher" class="css-17gfwuz"><a href="#demo-dogfetcher" aria-label="DEMO: DogFetcher" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>DEMO: DogFetcher</h3><p class="css-1vei6m9">Suppose we have a DogFetcher component that has a button that you can click to fetch a random dog. When the button is clicked, a GET request is made to the Dog API, and when the dog is received, we show it off in an <style data-emotion="css 1b3rm4t">.css-1b3rm4t{border-radius:0.3em;color:var(--theme-ui-colors-secondary);background-color:var(--theme-ui-colors-highlight);padding-top:0.15em;padding-bottom:0.05em;padding-left:0.2em;padding-right:0.2em;font-family:Menlo,monospace;font-size:0.9em;border-radius:0.3em;color:var(--theme-ui-colors-secondary);background-color:var(--theme-ui-colors-highlight);padding-top:0.15em;padding-bottom:0.05em;padding-left:0.2em;padding-right:0.2em;font-family:Menlo,monospace;font-size:0.9em;}</style><code class="css-1b3rm4t">&lt;img /&gt;</code> tag.
A typical implementation with React Hooks might look like this:</p><style data-emotion="css rczgmi">.css-rczgmi{font-family:Menlo,monospace;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;margin-bottom:8px;color:white;background-color:var(--theme-ui-colors-prism-background);overflow:auto;border-radius:10px;padding:16px;}.css-rczgmi .attr-name{font-style:italic;}.css-rczgmi .comment{color:var(--theme-ui-colors-prism-comment);}.css-rczgmi .attr-name,.css-rczgmi .string,.css-rczgmi .url{color:var(--theme-ui-colors-prism-string);}.css-rczgmi .variable{color:var(--theme-ui-colors-prism-var);}.css-rczgmi .number{color:var(--theme-ui-colors-prism-number);}.css-rczgmi .builtin,.css-rczgmi .char,.css-rczgmi .constant,.css-rczgmi .function{color:var(--theme-ui-colors-prism-constant);}.css-rczgmi .punctuation,.css-rczgmi .selector,.css-rczgmi .doctype{color:var(--theme-ui-colors-prism-punctuation);}.css-rczgmi .class-name{color:var(--theme-ui-colors-prism-className);}.css-rczgmi .tag,.css-rczgmi .operator,.css-rczgmi .keyword{color:var(--theme-ui-colors-prism-tag);}.css-rczgmi .boolean{color:var(--theme-ui-colors-prism-boolean);}.css-rczgmi .property{color:var(--theme-ui-colors-prism-property);}.css-rczgmi .namespace{color:var(--theme-ui-colors-prism-namespace);}.css-rczgmi .highlight{background:hsla(0, 0%, 40%, .5);}</style><style data-emotion="css nasdwz">.css-nasdwz{font-family:Menlo,monospace;font-size:inherit;background-color:#faf8f5;color:#728fcb;}.css-nasdwz .comment,.css-nasdwz .prolog,.css-nasdwz .doctype,.css-nasdwz .cdata,.css-nasdwz .punctuation{color:#b6ad9a;}.css-nasdwz .namespace{opacity:0.7;}.css-nasdwz .tag,.css-nasdwz .operator,.css-nasdwz .number{color:#063289;}.css-nasdwz .property,.css-nasdwz .function{color:#b29762;}.css-nasdwz .tag-id,.css-nasdwz .selector,.css-nasdwz .atrule-id{color:#2d2006;}.css-nasdwz .attr-name{color:#896724;}.css-nasdwz .boolean,.css-nasdwz .string,.css-nasdwz .entity,.css-nasdwz .url,.css-nasdwz .attr-value,.css-nasdwz .keyword,.css-nasdwz .control,.css-nasdwz .directive,.css-nasdwz .unit,.css-nasdwz .statement,.css-nasdwz .regex,.css-nasdwz .at-rule{color:#728fcb;}.css-nasdwz .placeholder,.css-nasdwz .variable{color:#93abdc;}.css-nasdwz .deleted{text-decoration-line:line-through;}.css-nasdwz .inserted{text-decoration-line:underline;}.css-nasdwz .italic{font-style:italic;}.css-nasdwz .important,.css-nasdwz .bold{font-weight:bold;}.css-nasdwz .important{color:#896724;}.css-nasdwz .highlight{background:hsla(0, 0%, 70%, .5);}</style><style data-emotion="css 1lage2t">.css-1lage2t{font-family:Menlo,monospace;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;margin-bottom:8px;color:white;background-color:var(--theme-ui-colors-prism-background);overflow:auto;border-radius:10px;padding:16px;font-family:Menlo,monospace;font-size:inherit;background-color:#faf8f5;color:#728fcb;}.css-1lage2t .attr-name{font-style:italic;}.css-1lage2t .comment{color:var(--theme-ui-colors-prism-comment);}.css-1lage2t .attr-name,.css-1lage2t .string,.css-1lage2t .url{color:var(--theme-ui-colors-prism-string);}.css-1lage2t .variable{color:var(--theme-ui-colors-prism-var);}.css-1lage2t .number{color:var(--theme-ui-colors-prism-number);}.css-1lage2t .builtin,.css-1lage2t .char,.css-1lage2t .constant,.css-1lage2t .function{color:var(--theme-ui-colors-prism-constant);}.css-1lage2t .punctuation,.css-1lage2t .selector,.css-1lage2t .doctype{color:var(--theme-ui-colors-prism-punctuation);}.css-1lage2t .class-name{color:var(--theme-ui-colors-prism-className);}.css-1lage2t .tag,.css-1lage2t .operator,.css-1lage2t .keyword{color:var(--theme-ui-colors-prism-tag);}.css-1lage2t .boolean{color:var(--theme-ui-colors-prism-boolean);}.css-1lage2t .property{color:var(--theme-ui-colors-prism-property);}.css-1lage2t .namespace{color:var(--theme-ui-colors-prism-namespace);}.css-1lage2t .highlight{background:hsla(0, 0%, 40%, .5);}.css-1lage2t .comment,.css-1lage2t .prolog,.css-1lage2t .doctype,.css-1lage2t .cdata,.css-1lage2t .punctuation{color:#b6ad9a;}.css-1lage2t .namespace{opacity:0.7;}.css-1lage2t .tag,.css-1lage2t .operator,.css-1lage2t .number{color:#063289;}.css-1lage2t .property,.css-1lage2t .function{color:#b29762;}.css-1lage2t .tag-id,.css-1lage2t .selector,.css-1lage2t .atrule-id{color:#2d2006;}.css-1lage2t .attr-name{color:#896724;}.css-1lage2t .boolean,.css-1lage2t .string,.css-1lage2t .entity,.css-1lage2t .url,.css-1lage2t .attr-value,.css-1lage2t .keyword,.css-1lage2t .control,.css-1lage2t .directive,.css-1lage2t .unit,.css-1lage2t .statement,.css-1lage2t .regex,.css-1lage2t .at-rule{color:#728fcb;}.css-1lage2t .placeholder,.css-1lage2t .variable{color:#93abdc;}.css-1lage2t .deleted{text-decoration-line:line-through;}.css-1lage2t .inserted{text-decoration-line:underline;}.css-1lage2t .italic{font-style:italic;}.css-1lage2t .important,.css-1lage2t .bold{font-weight:bold;}.css-1lage2t .important{color:#896724;}.css-1lage2t .highlight{background:hsla(0, 0%, 70%, .5);}</style><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">DogFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">isLoading</span><span class="token punctuation">,</span><span class="token plain"> setIsLoading</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">dog</span><span class="token punctuation">,</span><span class="token plain"> setDog</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><style data-emotion="css 13aqjzy">.css-13aqjzy{display:inline-block;}</style><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">figure</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">dog</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">{</span><span class="token plain">dog </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">dog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">alt</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">doggo</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag">figure</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">        </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">          </span><span class="token tag script language-javascript function">setIsLoading</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript boolean">true</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">;</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">          </span><span class="token tag script language-javascript function">fetch</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript template-string string">https://dog.ceo/api/breeds/image/random</span><span class="token tag script language-javascript template-string template-punctuation string">`</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">            </span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript function">then</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript parameter">data</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> data</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript function">json</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">            </span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript function">then</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript parameter">response</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">              </span><span class="token tag script language-javascript function">setDog</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript">response</span><span class="token tag script language-javascript punctuation">.</span><span class="token tag script language-javascript">message</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">;</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">              </span><span class="token tag script language-javascript function">setIsLoading</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript boolean">false</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">;</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">            </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">;</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">        </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">      </span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">isLoading </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&quot;Fetching...&quot;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;Fetch dog!&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">This works, but there’s one immediate problem:
clicking the button more than once (while a dog is loading) will display one dog briefly,
and then replace that dog with another dog. That’s not very considerate to the first dog.
The typical solution to this is to add a <code class="css-1b3rm4t">disabled={isLoading}</code> attribute to the button:</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">DogFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">    </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">      </span><span class="token tag script language-javascript comment">// ... excessive amount of ad-hoc logic</span><span class="token tag script language-javascript"></span></div><div class="token-line"><span class="token tag script language-javascript">    </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">    </span><span class="token tag attr-name">disabled</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">isLoading</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"></span></div><div class="token-line"><span class="token tag">  </span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">{</span><span class="token plain">isLoading </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&quot;Fetching...&quot;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;Fetch dog!&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">This also works.</p><h3 id="what-can-possibly-go-wrong" class="css-17gfwuz"><a href="#what-can-possibly-go-wrong" aria-label="What can possibly go wrong?" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>What can possibly go wrong?</h3><p class="css-1vei6m9">Currently, the logic reads like this:</p><blockquote class="css-34uy4p"><p class="css-1vei6m9">When the button is clicked, fetch a new random dog, and set a flag to make sure that the button cannot be clicked again to fetch a dog while one is being fetched.</p></blockquote><p class="css-1vei6m9">However, the logic you <strong class="css-0">really</strong> want is this:</p><blockquote class="css-34uy4p"><p class="css-1vei6m9">When a new dog is requested, fetch it and make sure that another dog can’t be fetched at the same time.</p></blockquote><p class="css-1vei6m9">See the difference? The desired logic is completely separate from the button being clicked; it doesn’t matter how the request is made; it only matters what logic happens afterwards.</p><p class="css-1vei6m9">Suppose that you want to add the feature that double-clicking the image loads a new dog. What would you have to do?</p><p class="css-1vei6m9">It’s all too easy to forget to add the same “guard” logic on figure (after all, <code class="css-1b3rm4t">&lt;figure disabled={isLoading}&gt;</code> won’t work, go figure), but let’s say you’re an astute developer who remembers to add this logic:</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">DogFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">isLoading</span><span class="token punctuation">,</span><span class="token plain"> setIsLoading</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">dog</span><span class="token punctuation">,</span><span class="token plain"> setDog</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">fetchDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">isLoading</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">fetch</span><span class="token punctuation">(</span><span class="token template-string template-punctuation string">`</span><span class="token template-string string">https://dog.ceo/api/breeds/image/random</span><span class="token template-string template-punctuation string">`</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> data</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setDog</span><span class="token punctuation">(</span><span class="token plain">response</span><span class="token punctuation">.</span><span class="token plain">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">figure</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">dog</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">onDoubleClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">fetchDog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">dog </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">dog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">alt</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">doggo</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">figure</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">fetchDog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">isLoading </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&quot;Fetching...&quot;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;Fetch dog!&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">In reality, you can think about this as any use-case where some sort of “trigger” can happen from multiple locations.</p><h3 id="now-we--try-to-adding-features-and-complexity" class="css-17gfwuz"><a href="#now-we--try-to-adding-features-and-complexity" aria-label="Now we  try to adding features and complexity" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Now we  try to adding features and complexity</h3><p class="css-1vei6m9">Now let’s see what happens when we want to add basic “features”, such as:</p><ul class="css-0"><li class="css-1vei6m9">If fetching a dog fails, an error should be shown.</li><li class="css-1vei6m9">Fetching a dog should be cancellable.</li></ul><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">DogFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">isLoading</span><span class="token punctuation">,</span><span class="token plain"> setIsLoading</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">error</span><span class="token punctuation">,</span><span class="token plain"> setError</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">canceled</span><span class="token punctuation">,</span><span class="token plain"> setCanceled</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">dog</span><span class="token punctuation">,</span><span class="token plain"> setDog</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">fetchDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">setCanceled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">setError</span><span class="token punctuation">(</span><span class="token keyword">null</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token function">fetchRandomDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">response</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token comment">// This should work... but it doesn&#x27;t!</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">canceled</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setDog</span><span class="token punctuation">(</span><span class="token plain">response</span><span class="token punctuation">.</span><span class="token plain">message</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setCanceled</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function">setError</span><span class="token punctuation">(</span><span class="token plain">error</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">cancel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">setIsLoading</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token function">setCanceled</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain">error </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag attr-name">style</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> color</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript string">&quot;red&quot;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">{</span><span class="token plain">error</span><span class="token punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">figure</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">dog</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">onDoubleClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">fetchDog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">dog </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">dog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">alt</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">doggo</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">figure</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">fetchDog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">isLoading </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&quot;Fetching...&quot;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;Fetch dog!&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">cancel</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain">Cancel</span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><h3 id="lets-try-usereducer-and-useeffect-hooks-to-reducing-complexity" class="css-17gfwuz"><a href="#lets-try-usereducer-and-useeffect-hooks-to-reducing-complexity" aria-label="Let’s try ,[object Object], and ,[object Object], hooks to reducing complexity" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Let’s try <code class="css-1b3rm4t">useReducer</code> and <code class="css-1b3rm4t">useEffect</code> hooks to reducing complexity</h3><p class="css-1vei6m9">Instead of haphazardly adding Boolean flags everywhere, let’s clean this up with the <code class="css-1b3rm4t">useReducer</code> and <code class="css-1b3rm4t">useEffect</code> hooks. These hooks are useful because they express some concepts that lead to better logic organization:</p><ul class="css-0"><li class="css-1vei6m9">The <code class="css-1b3rm4t">useReducer</code> hook uses reducers, which return the next state given the current state and some event that just occurred.</li><li class="css-1vei6m9">The <code class="css-1b3rm4t">useEffect</code> hook synchronizes effects with state.</li></ul><p class="css-1vei6m9">To help us organize the various app states, let’s define a few and put them under a <code class="css-1b3rm4t">status</code> property:</p><ul class="css-0"><li class="css-1vei6m9">An <code class="css-1b3rm4t">&quot;idle&quot;</code> status means that nothing happened yet.</li><li class="css-1vei6m9">A <code class="css-1b3rm4t">&quot;loading&quot;</code> status means that the dog is currently being fetched.</li><li class="css-1vei6m9">A <code class="css-1b3rm4t">&quot;success&quot;</code> status means that the dog was successfully fetched.</li><li class="css-1vei6m9">A <code class="css-1b3rm4t">&quot;failure&quot;</code> status means that an error occurred while trying to fetch the dog.</li></ul><p class="css-1vei6m9">Now let’s define a few events that can happen in the app. Keep in mind: these events can happen from <strong class="css-0">anywhere</strong>, whether it’s initiated by the user or somewhere else:</p><ul class="css-0"><li class="css-1vei6m9">A <code class="css-1b3rm4t">&quot;FETCH&quot;</code> event indicates that fetching a dog should occur.</li><li class="css-1vei6m9">A <code class="css-1b3rm4t">&quot;RESOLVE&quot;</code> event with a <code class="css-1b3rm4t">data</code> property indicates that a dog was successfully fetched.</li><li class="css-1vei6m9">A <code class="css-1b3rm4t">&quot;REJECT&quot;</code> event with an <code class="css-1b3rm4t">error</code> property indicates that a dog was unable to be fetched for some reason.</li><li class="css-1vei6m9">A <code class="css-1b3rm4t">&quot;CANCEL&quot;</code> event indicates that an in-progress fetch should be canceled.</li></ul><p class="css-1vei6m9">Great! Now let’s write our reducer:</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">dogReducer</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token parameter punctuation">,</span><span class="token parameter"> event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token punctuation">.</span><span class="token plain">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;FETCH&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;RESOLVE&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        dog</span><span class="token operator">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token plain">data</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;REJECT&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;failure&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        error</span><span class="token operator">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token plain">error</span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;CANCEL&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;idle&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">default</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> initialState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  dog</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">;</span></div></pre><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">DogFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> dispatch</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useReducer</span><span class="token punctuation">(</span><span class="token plain">dogReducer</span><span class="token punctuation">,</span><span class="token plain"> initialState</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> error</span><span class="token punctuation">,</span><span class="token plain"> dog</span><span class="token punctuation">,</span><span class="token plain"> status </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> state</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ... fetchDog?</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">status</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain">error </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag attr-name">style</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> color</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript string">&quot;red&quot;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">{</span><span class="token plain">error</span><span class="token punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">figure</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">dog</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">onDoubleClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript function">dispatch</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> type</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript string">&quot;FETCH&quot;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">dog </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">dog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">alt</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">doggo</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">figure</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript function">dispatch</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> type</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript string">&quot;FETCH&quot;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">status </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token plain"> </span><span class="token operator">?</span><span class="token plain"> </span><span class="token string">&quot;Fetching...&quot;</span><span class="token plain"> </span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;Fetch dog!&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript function">dispatch</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> type</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript string">&quot;CANCEL&quot;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain">Cancel</span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">Reducer can be reused and independently testes.</p><p class="css-1vei6m9">However, the question remains: how do we execute the side-effect of actually fetching the dog? Well, since the <code class="css-1b3rm4t">useEffect</code> hook is meant for synchronizing effects with state, we can synchronize the <code class="css-1b3rm4t">fetchDog()</code> effect with <code class="css-1b3rm4t">status === &#x27;loading&#x27;</code>, since <code class="css-1b3rm4t">&#x27;loading&#x27;</code> means that that side-effect is being executed anyway:</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token operator">/</span><span class="token plain"> </span><span class="token operator">...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">status </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">let</span><span class="token plain"> canceled </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">false</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token function">fetchRandomDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">canceled</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;RESOLVE&quot;</span><span class="token punctuation">,</span><span class="token plain"> data </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token parameter">error</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">if</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">canceled</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token keyword">return</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token function">dispatch</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> type</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;REJECT&quot;</span><span class="token punctuation">,</span><span class="token plain"> error </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        canceled </span><span class="token operator">=</span><span class="token plain"> </span><span class="token boolean">true</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">status</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// ...</span></div></pre><p class="css-1vei6m9">The logic above works great. We’re able to:</p><ul class="css-0"><li class="css-1vei6m9">Click the “Fetch dog” button to fetch a dog</li><li class="css-1vei6m9">Display a random dog when fetched</li><li class="css-1vei6m9">Show an error if the dog is unable to be fetched</li><li class="css-1vei6m9">Cancel an in-flight fetch request by clicking the “Cancel” button</li><li class="css-1vei6m9">Prevent more than one dog from being fetched at the same time</li></ul><h3 id="we-dont-need-to-add-disabled-attribute" class="css-17gfwuz"><a href="#we-dont-need-to-add-disabled-attribute" aria-label="We don’t need to add “disabled” attribute" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>We don’t need to add “disabled” attribute</h3><p class="css-1vei6m9">… all without having to put any logic in the <code class="css-1b3rm4t">&lt;button disabled={...}&gt;</code> attribute. In fact, we completely forgot to do so anyway, and the logic still works!</p><p class="css-1vei6m9">This is how you know your logic is robust; when it works, regardless of the UI. Whether the “Fetch dog” button is disabled or not, clicking it multiple times in a row won’t exhibit any unexpected behavior.</p><p class="css-1vei6m9">Also, because most of the logic is delegated to a <code class="css-1b3rm4t">dogReducer</code> function defined <em class="css-0">outside</em> of your component, it is:</p><ul class="css-0"><li class="css-1vei6m9">easy to make into a custom hook</li><li class="css-1vei6m9">easy to test</li><li class="css-1vei6m9">easy to reuse in other components</li><li class="css-1vei6m9">easy to reuse in other <em class="css-0">frameworks</em></li></ul><p class="css-1vei6m9">Check the <a href="https://codesandbox.io/s/gifted-surf-0jmnz?from-embed" class="css-1nubre7">final result</a></p><h3 id="pushing-effects-to-the-side" class="css-17gfwuz"><a href="#pushing-effects-to-the-side" aria-label="Pushing effects to the side" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Pushing effects to the side</h3><p class="css-1vei6m9">There’s one lingering thought, though… is <code class="css-1b3rm4t">useEffect()</code> the ideal place to put a side effect, such as fetching?</p><p class="css-1vei6m9"><em class="css-0">Maybe, maybe not.</em></p><p class="css-1vei6m9">Honestly, in most use-cases, it works, and it works fine. But it’s difficult to test or separate that effect from your component code. And with the upcoming Suspense and Concurrent Mode features in React, the recommendation is to execute these side-effects when some action triggers them, rather than in <code class="css-1b3rm4t">useEffect()</code>. This is because the official React advice is:</p><blockquote class="css-34uy4p"><p class="css-1vei6m9">If you’re working on a data fetching library, there’s a crucial aspect of Render-as-You-Fetch you don’t want to miss. <strong class="css-0">We kick off fetching before rendering.</strong></p><p class="css-1vei6m9"><a href="https://reactjs.org/docs/concurrent-mode-suspense.html#start-fetching-early" class="css-1nubre7">https://reactjs.org/docs/concurrent-mode-suspense.html#start-fetching-early</a></p></blockquote><ol class="css-0"><li class="css-1vei6m9">Parallel data and view trees</li><li class="css-1vei6m9">Fetch in event handlers</li><li class="css-1vei6m9">Load data incrementally</li><li class="css-1vei6m9">Treat code like data</li></ol><p class="css-1vei6m9">All of this can happen outside of the component render cycle, because it doesn’t necessarily concern the view. Unfortunately, React doesn’t have a built-in way (yet?) to handle state management, side-effects, data fetching, caching etc. outside of the components (we all know Relay is not commonly used), so let’s explore one way we can accomplish this completely outside of the component.</p><p class="css-1vei6m9">See <a href="https://reactjs.org/blog/2019/11/06/building-great-user-experiences-with-concurrent-mode-and-suspense.html" class="css-1nubre7">https://reactjs.org/blog/2019/11/06/building-great-user-experiences-with-concurrent-mode-and-suspense.html</a></p><h3 id="using-a-state-machine" class="css-17gfwuz"><a href="#using-a-state-machine" aria-label="Using a state machine" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Using a state machine</h3><p class="css-1vei6m9">In this case, we’re going to use a state machine to manage and orchestrate state. If you’re new to state machines, just know that they feel like your typical Redux reducers with a few more “rules”. Those rules have some powerful advantages, and are also the mathematical basis for how literally every computer in existence today works. So they might be worth learning.</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> Machine</span><span class="token punctuation">,</span><span class="token plain"> assign </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&quot;xstate&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">import</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> useMachine </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token keyword">from</span><span class="token plain"> </span><span class="token string">&quot;@xstate/react&quot;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain"></span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">const</span><span class="token plain"> dogFetcherMachine </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">Machine</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  id</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;dog fetcher&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  initial</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  context</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    dog</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token keyword">null</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  states</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    idle</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      on</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token constant">FETCH</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    loading</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      invoke</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token function-variable function">src</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> </span><span class="token function">fetchRandomDog</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        onDone</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          target</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          actions</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token function-variable function">dog</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token parameter punctuation">,</span><span class="token parameter"> event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token plain">data</span><span class="token punctuation">.</span><span class="token plain">message </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        onError</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          target</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;failure&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          actions</span><span class="token operator">:</span><span class="token plain"> </span><span class="token function">assign</span><span class="token punctuation">(</span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token function-variable function">error</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token parameter">_</span><span class="token parameter punctuation">,</span><span class="token parameter"> event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">=&gt;</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token plain">data </span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      on</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token constant">CANCEL</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;idle&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    success</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      on</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token constant">FETCH</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    failure</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      on</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> </span><span class="token constant">FETCH</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token plain"> </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></div></pre><p class="css-1vei6m9">otice how the machine looks like our previous reducer, with a couple of differences:</p><ul class="css-0"><li class="css-1vei6m9">It looks like some sort of configuration object instead of a switch statement</li><li class="css-1vei6m9">We’re matching on the <em class="css-0">state</em> first, instead of the <em class="css-0">event</em> first</li><li class="css-1vei6m9">We’re invoking the <code class="css-1b3rm4t">fetchRandomDog()</code> promise inside the machine! 😱</li></ul><p class="css-1vei6m9">Don’t worry; we’re not actually executing any side-effects inside of this machine. In fact, <code class="css-1b3rm4t">dogFetcherMachine.transition(state, event)</code> is a <em class="css-0">pure function</em> that tells you the next state given the current state and event. Seems familiar, huh?</p><p class="css-1vei6m9">Furthermore, I can copy-paste this exact machine and <a href="https://xstate.js.org/viz" class="css-1nubre7">visualize it in XState Viz</a>:</p><p class="css-1vei6m9">So what does our component code look like now? Take a look:</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">DogFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">current</span><span class="token punctuation">,</span><span class="token plain"> send</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useMachine</span><span class="token punctuation">(</span><span class="token plain">dogFetcherMachine</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"> error</span><span class="token punctuation">,</span><span class="token plain"> dog </span><span class="token punctuation">}</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> current</span><span class="token punctuation">.</span><span class="token plain">context</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token plain">error </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">span</span><span class="token tag"> </span><span class="token tag attr-name">style</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript"> color</span><span class="token tag script language-javascript operator">:</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript string">&quot;red&quot;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript punctuation">}</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">{</span><span class="token plain">error</span><span class="token punctuation">}</span><span class="token tag punctuation">&lt;/</span><span class="token tag">span</span><span class="token tag punctuation">&gt;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">figure</span><span class="token tag"> </span><span class="token tag attr-name">className</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">dog</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag attr-name">onDoubleClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript function">send</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript string">&quot;FETCH&quot;</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">dog </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token tag punctuation">&lt;</span><span class="token tag">img</span><span class="token tag"> </span><span class="token tag attr-name">src</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">dog</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag"> </span><span class="token tag attr-name">alt</span><span class="token tag attr-value punctuation attr-equals">=</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag attr-value">doggo</span><span class="token tag attr-value punctuation">&quot;</span><span class="token tag"> </span><span class="token tag punctuation">/&gt;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">figure</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript function">send</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript string">&quot;FETCH&quot;</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">current</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;loading&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token string">&quot;Fetching...&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">current</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;success&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token string">&quot;Fetch another dog!&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">current</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;idle&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token string">&quot;Fetch dog&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token punctuation">{</span><span class="token plain">current</span><span class="token punctuation">.</span><span class="token function">matches</span><span class="token punctuation">(</span><span class="token string">&quot;failure&quot;</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token operator">&amp;&amp;</span><span class="token plain"> </span><span class="token string">&quot;Try again&quot;</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">onClick</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript operator">=&gt;</span><span class="token tag script language-javascript"> </span><span class="token tag script language-javascript function">send</span><span class="token tag script language-javascript punctuation">(</span><span class="token tag script language-javascript string">&quot;CANCEL&quot;</span><span class="token tag script language-javascript punctuation">)</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain">Cancel</span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">div</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">Here’s the difference between using a state machine and a reducer:</p><ul class="css-0"><li class="css-1vei6m9">The hook signature for <code class="css-1b3rm4t">useMachine(...)</code> looks almost the same as <code class="css-1b3rm4t">useReducer(...)</code></li><li class="css-1vei6m9">No fetching logic exists inside the component; it’s all external!</li><li class="css-1vei6m9">There’s a nice <code class="css-1b3rm4t">current.matches(...)</code> function that lets us customize our button text</li><li class="css-1vei6m9"><code class="css-1b3rm4t">send(...)</code> instead of <code class="css-1b3rm4t">dispatch(...)</code>… and it takes a plain string! (Or an object, up to you).</li></ul><p class="css-1vei6m9">A state machine/statechart defines its transitions from the state because it answers the question: “Which events should be handled <em class="css-0">from this state?</em>” The reason that having <code class="css-1b3rm4t">&lt;button disabled={isLoading}&gt;</code> is fragile is because we admit that some “FETCH” event can cause an effect no matter which state we’re in, so we have to clean up our ~mess~ faulty logic by preventing the user from clicking the button while loading.</p><p class="css-1vei6m9">Instead, it’s better to be proactive about your logic. Fetching should only happen when the app is not in some <code class="css-1b3rm4t">&quot;loading&quot;</code> state, which is what is clearly defined in the state machine — the <code class="css-1b3rm4t">&quot;FETCH&quot;</code> event is not handled in the <code class="css-1b3rm4t">&quot;loading&quot;</code> state, which means it has no effect. Perfect.</p><h3 id="section-summary" class="css-17gfwuz"><a href="#section-summary" aria-label="Section Summary" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Section Summary</h3><p class="css-1vei6m9">Disabling a button is not logic. Rather, it is a sign that logic is fragile and bug-prone. In my opinion, disabling a button should only be a visual cue to the user that clicking the button <em class="css-0">will have no effect</em>.</p><p class="css-1vei6m9">So when you’re creating fetching logic (or any other kind of complex logic) in your applications, no matter the framework, ask yourself these questions:</p><ul class="css-0"><li class="css-1vei6m9">What are the concrete, finite states this app/component can be in? E.g., “loading”, “success”, “idle”, “failure”, etc.</li><li class="css-1vei6m9">What are all the possible events that can occur, regardless of state? This includes events that don’t come from the user (such as <code class="css-1b3rm4t">&quot;RESOLVE&quot;</code> or <code class="css-1b3rm4t">&quot;REJECT&quot;</code> events from promises)</li><li class="css-1vei6m9">Which of the finite states should handle these events?</li><li class="css-1vei6m9">How can I organize my app logic so that these events are handled properly in those states?</li></ul><p class="css-1vei6m9">A state machine might be a different, unfamiliar way of thinking about your application logic, but they’re extremely useful. Instead of approaching logic from a <strong class="css-0">“bottom-up”</strong> perspective (imperatively doing things based on events), they take a ”<strong class="css-0">top-down”</strong> approach and primarily consider <em class="css-0">behaviors</em>, which describe how the logic will react to events in a given finite state (such as <code class="css-1b3rm4t">loading</code>, <code class="css-1b3rm4t">editing</code>, <code class="css-1b3rm4t">disabled</code>, etc.).</p><p class="css-1vei6m9"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:882px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:50.43478260869565%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABHElEQVQoz3VSBwrEQAjc/38whfSE9N67xwgbkrvcguiKjmMRRETnedJd443jSE3TUNu2NAwDHcfBfugwDGnf958cPPEGluc52bZNruuyLorikaQoChf5C3h3lmVJfd+zDZ1lGTMKguDym6Z52TJfirijp2lKdV1zm2BVVRUDSv+2bRxnGAZN00RvTyAQrNCaZVkMgurLsvC81nXl9lAAcfCDIVhLHwRjQp5AdcxKVVXSNI3ZABQgELBFgud55Ps+M9N1nQk4jsOCcYA1CjxajuP40XLXdQyKyvM8X7MGQ/xfW0aQPAnYEgg2wMEM1cEE/u+lIFdi8FLezgaLQHvQSZJcQPezuW/5wfD7sKWNtqMo4uGDqfSDCWb277A/+YkEw/jZWhMAAAAASUVORK5CYII=&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="image-20211011035427167" title="image-20211011035427167" src="/tech-share/static/57558f3cde57c997af80a2122d63c96d/90712/image-20211011035427167.png" srcSet="/tech-share/static/57558f3cde57c997af80a2122d63c96d/e4d6b/image-20211011035427167.png 345w,/tech-share/static/57558f3cde57c997af80a2122d63c96d/1e043/image-20211011035427167.png 690w,/tech-share/static/57558f3cde57c997af80a2122d63c96d/90712/image-20211011035427167.png 882w" sizes="(max-width: 882px) 100vw, 882px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1vei6m9"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:695px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:55.94202898550725%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB70lEQVQoz3VTS5PSQBDmR3i2/ImevenBs+XFi9Ze1ONqleXycAmwsAu1WYtiyWSBvCZZHkHyEEIImxA+awZB1oK+zEx3zzdff92TAYA4foCuGxiNbLiOg0UUMTfSNMV6vcbW2JmZ57owKMVsNsNwMIDn+9zPcjNsM/3tI5/LoVQqoyQUQYiMf5bC9z0E83DnYUCSJEEQBNTrDUwmk8eAURRhPLbhui5f52GIZrMJalB0ZBU6NWEqdzDVDhRFgappHMCyLETL5aNqMjhiFrXw4eN7fMq9RVf+iZOygtefS/hyesoJHLMMC/b7fUynU3ieh+XfFzs9Dbc3ZdSfP8OPNy/w5CXB01ctXF+LcJxNicFsBtseI5zPEQQB4iRBhgHdiCLy+QK63R7abQkyIajVakgeYliX5wjcX3hXkHFSUUCpgUajAUII7mSCs7MsikWB+8JwsS15zVmuVqsd9Xa7zS8Vyhc4LwooZr+h8P0rer0eBoMBz0niGKPRCNb9PVzX2ZS8Pxb7o2HbNqrVKkxqQNM03pjyRRXZbBZJkhzUb9cUttmfue1KKeUsGQvTNDk7URSh6zqPM81YVfv3jnZ5m8TEZnIMh8Md+8Ui5OCVSgWXV1cwDIo0XR8GPPQz/o8xvVqtW6iqytkSImHibDT8A0P8M49OZU7cAAAAAElFTkSuQmCC&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="image-20211011035449635" title="image-20211011035449635" src="/tech-share/static/178370b48f6a166b073af9bf29abb4df/83b75/image-20211011035449635.png" srcSet="/tech-share/static/178370b48f6a166b073af9bf29abb4df/e4d6b/image-20211011035449635.png 345w,/tech-share/static/178370b48f6a166b073af9bf29abb4df/1e043/image-20211011035449635.png 690w,/tech-share/static/178370b48f6a166b073af9bf29abb4df/83b75/image-20211011035449635.png 695w" sizes="(max-width: 695px) 100vw, 695px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1vei6m9">Because of their explicit, declarative nature, state machines force you to think about the entire flow of your logic (including all the edge-cases), and make it virtually impossible to end up in an “impossible state”, as long as your model doesn’t allow it. Only defined transitions can happen; and if an unexpected transition happens, it means there is an implicit state machine where that transition <em class="css-0">does</em> exist. The goal of state machines is to eliminate the implicit transitions so that we can know exactly what can happen in any state for any potential event.</p><p class="css-1vei6m9">State machines are <strong class="css-0">not a solution for everything</strong> - just like anything else, they make sense for some use-cases (workflows, processes, modes, statuses, etc.) but not all use-cases. You shouldn’t use state machines everywhere, or even implement them explicitly all of the time (that’s what abstractions are for). They make a good refactor target, and they’re great for visually modeling your logic with pencil and paper, even if you ultimately decide not to use them in your code. But when working with logic that deals with explicit states, events, and transitions (which, surprise, tends to be the majority of app logic), state machines are a brilliant, natural solution.</p><h3 id="基于有限状态机实现-live-share" class="css-17gfwuz"><a href="#基于有限状态机实现-live-share" aria-label="基于有限状态机实现 Live Share" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>基于有限状态机实现 Live Share</h3><p class="css-1vei6m9">举一个 XState 作者本人的例子，XState 的作者 David 来自微软，他还开发了 VSCode 的 Live Share 插件，可以用来结对编程、面试或者代码分享。</p><p class="css-1vei6m9">David 在开发这个插件时，因为复杂的逻辑，写了很多 bug。尤其是这类工具类应用，我们需要在同一个页面停留，不断处理非常多的状态。</p><p class="css-1vei6m9">拿登录举例。登录后进入 Signed In 状态，这时可以做两件事，share (分享) 一个 session (会话) 或者 join (加入) 一个 session。登录失败，需要返回 Signed Out 状态。</p><p class="css-1vei6m9"><span class="gatsby-resp-image-wrapper" style="position:relative;display:block;margin-left:auto;margin-right:auto;max-width:743px">
      <span class="gatsby-resp-image-background-image" style="padding-bottom:42.608695652173914%;position:relative;bottom:0;left:0;background-image:url(&#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsTAAALEwEAmpwYAAABkElEQVQoz1WS25LiIBRFfZ0GEoFcISGJ6ajx0ra+zf9/2JoC7bH6YdUpoDjsvTmbuq4pioKyLFEqQymFkortdou1NmGMee4nMqSUaK3TWdvWfJ1nmtqipGCzLAu3241xHOk6T+gLvCs5Ho/c799cr1fmecb3La5rcF1FF1pO64nH48G6rhwPB6w2ZEqxGYaBaZoIsQ4Dh7Zm5xxN0ybVkadCmVTXPtCFgeXzk3EI6W7je6T4eDaMNqKFWPMsw0X72iCEIMuyZC02KouC0A20zuN9j8639M6yXyaa1mO0xmz1s2G8GIn5CKmQr5xivjGOaC3aKq3l72PiMDvEh8Qaw2ldedzuXNYLneveDd+N81/rYeo5nGeKwuJbxzJ5XF0ghUgqp93AvB9TNNHN5kfdmzyRIshzwtgz73eE0FMVFeKPRAqFMZq2aVn2M9MupIzVT4a/eVkXIr26Hlfu96flXOVkMkMJRec9l/OZ768bQx9SROlT4g/+xr4w/+cz1qqqsMZitcVok/ar1xRUr0mI/AN4oON6LHjJTQAAAABJRU5ErkJggg==&#x27;);background-size:cover;display:block"></span>
  <img class="gatsby-resp-image-image css-0" alt="image-20211011032746664" title="image-20211011032746664" src="/tech-share/static/3c95b1b13c4b81b29f0e299b3c9ff7f2/f2793/image-20211011032746664.png" srcSet="/tech-share/static/3c95b1b13c4b81b29f0e299b3c9ff7f2/e4d6b/image-20211011032746664.png 345w,/tech-share/static/3c95b1b13c4b81b29f0e299b3c9ff7f2/1e043/image-20211011032746664.png 690w,/tech-share/static/3c95b1b13c4b81b29f0e299b3c9ff7f2/f2793/image-20211011032746664.png 743w" sizes="(max-width: 743px) 100vw, 743px" style="width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0" loading="lazy"/>
    </span></p><p class="css-1vei6m9">以上是基本流程。除此之外，用户可能在 share session 的过程中 sign out，还可能在 share session 的同时尝试 join 另一个 session。这些逻辑可以归类为一堆 if else，但利用状态机可以使它一目了然。</p><p class="css-1vei6m9">并且，通过监听状态转移，作者轻松实现了 Live Share 后来新增的埋点需求。</p><pre class="language-js prism-code language-javascript css-1lage2t"><div class="token-line"><span class="token function">transition</span><span class="token punctuation">(</span><span class="token parameter">currentState</span><span class="token parameter punctuation">,</span><span class="token parameter"> event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">const</span><span class="token plain"> nextState </span><span class="token operator">=</span><span class="token plain"> </span><span class="token comment">//...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token maybe-class-name">Telemetry</span><span class="token punctuation">.</span><span class="token method function property-access">sendEvent</span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        currentState</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        nextState</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        event</span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword control-flow">return</span><span class="token plain"> nextState</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9"><img src="G:%5CGit%5Cscrollycoding-preview%5Cposts%5Cimage-20211011032818722.png" alt="image-20211011032818722" class="css-0"/></p><p class="css-1vei6m9">从图上能够明显看出，用户进行 sign in 的频率最高。</p><p class="css-1vei6m9">登录后，用户进行 share 和 join session 的频率差不多。同时，它也清晰地展示了有多少用户进入了 success 状态，多少用户进入了 error 状态。</p><h3 id="you-dont-need-state-machine" class="css-17gfwuz"><a href="#you-dont-need-state-machine" aria-label="You don’t need state machine" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>You don’t need state machine</h3><p class="css-1vei6m9">You do not need a state machine library (like XState) to do this.</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">dogReducer</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token parameter punctuation">,</span><span class="token parameter"> event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">   </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token punctuation">.</span><span class="token plain">status</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;RESOLVE&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;success&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              dog</span><span class="token operator">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token plain">data</span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;REJECT&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;failure&quot;</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              error</span><span class="token operator">:</span><span class="token plain"> event</span><span class="token punctuation">.</span><span class="token plain">error</span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;CANCEL&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;idle&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;success&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;FETCH&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;failure&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">          </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;FETCH&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;idle&quot;</span><span class="token operator">:</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">            </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&quot;FETCH&quot;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">                status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&quot;loading&quot;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">              </span><span class="token punctuation">}</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">       </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">   </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">As the author of the code, the event-first (bottom-up) approach might seem fine to you; after all, if it works, it works. One of the main advantages of taking a “finite-state-first” (top-down) approach and using state machines is that the logic is not only more clear (since it’s grouped by finite state), it’s more robust: you can ensure that an event won’t be improperly handled in a state that it shouldn’t be handled in. In other words, you prevent <em class="css-0">impossible states</em> and <em class="css-0">impossible transitions</em> without having to litter your code with <code class="css-1b3rm4t">if</code>-statements and excessive defensive programming.</p><p class="css-1vei6m9">I also like to think of state machines as a formal way of communicating logic. If you were describing the above logic, here’s how it would sound with an event-first approach:</p><blockquote class="css-34uy4p"><p class="css-1vei6m9">When data is received, do something, but only if the “loading” flag is true.</p></blockquote><p class="css-1vei6m9">And with a finite-state-first approach:</p><blockquote class="css-34uy4p"><p class="css-1vei6m9">In the “loading” state, when data is received, do something.</p></blockquote><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token comment">// &#x27;loading&#x27; behavior</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">loadingState</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token parameter punctuation">,</span><span class="token parameter"> event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// switch only on the event</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">event</span><span class="token punctuation">.</span><span class="token plain">type</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;DATA_RECEIVED&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        </span><span class="token operator">...</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">        status</span><span class="token operator">:</span><span class="token plain"> </span><span class="token string">&#x27;success&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain"></span><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">dataMachine</span><span class="token punctuation">(</span><span class="token parameter">state</span><span class="token parameter punctuation">,</span><span class="token parameter"> event</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">switch</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">.</span><span class="token plain">status</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token keyword">case</span><span class="token plain"> </span><span class="token string">&#x27;loading&#x27;</span><span class="token operator">:</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token comment">// handle the event with &#x27;loading&#x27; behavior</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token function">loadingState</span><span class="token punctuation">(</span><span class="token plain">state</span><span class="token punctuation">,</span><span class="token plain"> event</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">This approach is outlined in the <a href="https://redux.js.org/style-guide/style-guide/#treat-reducers-as-state-machines" class="css-1nubre7">Redux style guide recommendation: Treat Reducers as State Machines</a>. It’s a very organized approach, and each “behavior function” can be individually tested, since they are isolated, pure reducers.</p><p class="css-1vei6m9">In fact, you might not even need <code class="css-1b3rm4t">useReducer</code> when you’re first adopting these principles. Even something as simple as having a state variable representing a finite state can already clean up your logic plenty:</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">DogFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// &#x27;idle&#x27; or &#x27;loading&#x27; or &#x27;success&#x27; or &#x27;error&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">status</span><span class="token punctuation">,</span><span class="token plain"> setStatus</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;idle&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">And just like that, you’ve eliminated <code class="css-1b3rm4t">isLoading</code>, <code class="css-1b3rm4t">isError</code>, <code class="css-1b3rm4t">isSuccess</code>, <code class="css-1b3rm4t">startedLoading</code>, and whatever Boolean flags you were going to create. And if you really start to miss that <code class="css-1b3rm4t">isLoading</code> flag (for whatever reason), you can still have it, but ONLY if it’s derived from your organized, finite states. The <code class="css-1b3rm4t">isLoading</code> variable should NEVER be a primary source of state:</p><pre class="language-jsx prism-code language-jsx css-1lage2t"><div class="token-line"><span class="token keyword">function</span><span class="token plain"> </span><span class="token function">DogFetcher</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token plain"> </span><span class="token punctuation">{</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token comment">// &#x27;idle&#x27; or &#x27;loading&#x27; or &#x27;success&#x27; or &#x27;error&#x27;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> </span><span class="token punctuation">[</span><span class="token plain">status</span><span class="token punctuation">,</span><span class="token plain"> setStatus</span><span class="token punctuation">]</span><span class="token plain"> </span><span class="token operator">=</span><span class="token plain"> </span><span class="token function">useState</span><span class="token punctuation">(</span><span class="token string">&#x27;idle&#x27;</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">const</span><span class="token plain"> isLoading </span><span class="token operator">=</span><span class="token plain"> status </span><span class="token operator">===</span><span class="token plain"> </span><span class="token string">&#x27;loading&#x27;</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain css-13aqjzy">
</span></div><div class="token-line"><span class="token plain">  </span><span class="token keyword">return</span><span class="token plain"> </span><span class="token punctuation">(</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;</span><span class="token tag">button</span><span class="token tag"> </span><span class="token tag attr-name">disabled</span><span class="token tag script language-javascript script-punctuation punctuation">=</span><span class="token tag script language-javascript punctuation">{</span><span class="token tag script language-javascript">isLoading</span><span class="token tag script language-javascript punctuation">}</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">      </span><span class="token punctuation">{</span><span class="token comment">/* ... */</span><span class="token punctuation">}</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token tag punctuation">&lt;/</span><span class="token tag">button</span><span class="token tag punctuation">&gt;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">    </span><span class="token comment">// ...</span><span class="token plain"></span></div><div class="token-line"><span class="token plain">  </span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token plain"></span></div><div class="token-line"><span class="token plain"></span><span class="token punctuation">}</span></div></pre><p class="css-1vei6m9">Why we need a library like XState?</p><p class="css-1vei6m9">Because State Machine is not enough.</p><h3 id="state-charts" class="css-17gfwuz"><a href="#state-charts" aria-label="State charts" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>State charts</h3><p class="css-1vei6m9">State charts are a formalism for modeling stateful, reactive systems. Computer scientist David Harel presented this formalism as an extension to state machines in his 1987 paper <a href="https://www.sciencedirect.com/science/article/pii/0167642387900359/pdf" class="css-1nubre7">Statecharts: A Visual Formalism for Complex Systems</a>. Standars: <a href="https://www.w3.org/TR/scxml" class="css-1nubre7">W3 SCXML (Statechart XML) spec</a>.</p><p class="css-1vei6m9">Recommend learning material:
<a href="https://statecharts.dev/" class="css-1nubre7">https://statecharts.dev/</a></p><p class="css-1vei6m9">State charts extended from state machines, which include <strong class="css-0">hierarchical</strong> or <strong class="css-0">nested</strong> states <strong class="css-0">orthogonal</strong> or parallel states, history , <strong class="css-0">entry/exit</strong> actions on transitions and a lot more, especially solve state explosion(<a href="https://statecharts.dev/state-machine-state-explosion.html" class="css-1nubre7">https://statecharts.dev/state-machine-state-explosion.html</a>) that happens as state machines grow.</p><p class="css-1vei6m9">You can think of statecharts as essentially being state machines (statecharts can be decomposed into FSMs) with some essential features for better state organization and real-world use-cases:</p><ul class="css-0"><li class="css-1vei6m9"><strong class="css-0">Hierarchy</strong> (nested states)</li><li class="css-1vei6m9"><strong class="css-0">Orthogonality</strong> (parallel states)</li><li class="css-1vei6m9"><strong class="css-0">History</strong> (remembered states)</li><li class="css-1vei6m9"><strong class="css-0">State actions</strong> (entry, exit)</li><li class="css-1vei6m9"><strong class="css-0">Guarded transitions</strong></li><li class="css-1vei6m9"><strong class="css-0">Extended state</strong> (contextual data)</li></ul><p class="css-1vei6m9">More Details: <a href="https://statecharts.dev/what-is-a-statechart.html" class="css-1nubre7">https://statecharts.dev/what-is-a-statechart.html</a></p><p class="css-1vei6m9">Overall, the features of statecharts are very useful in many different situations:</p><ul class="css-0"><li class="css-1vei6m9"><strong class="css-0">Nested states</strong> are useful for grouping and refining behavior. Different “finite states” can all share behavior, while all having their own specific behavior.</li><li class="css-1vei6m9"><strong class="css-0">Parallel states</strong> are useful for representing behaviors that can occur simultaneously, without directly affecting each other.</li><li class="css-1vei6m9"><strong class="css-0">History states</strong> are useful for recalling which nested state the machine was previously in without having to specify all the possible “remembering” transitions.</li><li class="css-1vei6m9"><strong class="css-0">State actions</strong> are useful for specifying actions that should always be executed on any transition that enters/exits a state without having to specify those actions in all incoming/outgoing transitions.</li><li class="css-1vei6m9"><strong class="css-0">Guarded transitions</strong> are very important for conditionally taking transitions based on more than just the state and event type. They can take other data (extended state) and/or event data into consideration, as well.</li><li class="css-1vei6m9"><strong class="css-0">Extended state</strong> is absolutely necessary. Not all state is finite; “infinite” state also needs to be quantified. Statecharts allow you to distinguish between finite and extended state.</li></ul><p class="css-1vei6m9">There’s even more features of classic statecharts, such as “activities” (actions that occur <em class="css-0">throughout</em> a state), delays, eventless transitions, wildcard transitions, and more. And the more you work with statecharts, the more you realize just how essential most of these features actually are.</p><p class="css-1vei6m9">Examples:</p><p class="css-1vei6m9"><a href="https://statecharts.dev/on-off-statechart.html" class="css-1nubre7">A simple on-off statechart</a></p><p class="css-1vei6m9"><a href="http://realfiction.net/2019/01/30/xstate-a-typescript-state-machine-with-a-lot-of-features" class="css-1nubre7">Video Control</a></p><p class="css-1vei6m9"><a href="https://xstate-catalogue.com/" class="css-1nubre7">https://xstate-catalogue.com/</a></p><h3 id="do-we-need-a-library-for-statecharts" class="css-17gfwuz"><a href="#do-we-need-a-library-for-statecharts" aria-label="Do we need a library for statecharts?" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Do we need a library for statecharts?</h3><p class="css-1vei6m9">Yes.</p><h3 id="closing-thoughts" class="css-17gfwuz"><a href="#closing-thoughts" aria-label="Closing thoughts" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Closing thoughts</h3><p class="css-1vei6m9">If you’re satisfied manipulating state at any time and sprinkling <code class="css-1b3rm4t">if</code>-statements to patch up edge-cases, you probably don’t need explicit state machines.</p><p class="css-1vei6m9">If you want to use simple state machines to help organize app behavior and logic, you don’t need a library.</p><p class="css-1vei6m9">If you have complex logic and want to take advantage of more powerful state machine features to better manage this logic, you need statecharts.</p><p class="css-1vei6m9">And you <em class="css-0">definitely</em> need a library for statecharts. 😉</p><h3 id="reference" class="css-17gfwuz"><a href="#reference" aria-label="Reference" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Reference</h3><p class="css-1vei6m9"><a href="https://en.wikipedia.org/wiki/Finite-state_machine" class="css-1nubre7">https://en.wikipedia.org/wiki/Finite-state_machine</a>
<a href="https://statecharts.dev/" class="css-1nubre7">https://statecharts.dev/</a>
<a href="https://medium.com/@asolove/pure-ui-control-ac8d1be97a8d" class="css-1nubre7">https://medium.com/@asolove/pure-ui-control-ac8d1be97a8d</a>
<a href="http://slides.com/davidkhourshid/finite-state-machines" class="css-1nubre7">http://slides.com/davidkhourshid/finite-state-machines</a>
<a href="https://dev.to/davidkpiano/no-disabling-a-button-is-not-app-logic-598i" class="css-1nubre7">https://dev.to/davidkpiano/no-disabling-a-button-is-not-app-logic-598i</a>
<a href="http://www.ayqy.net/blog/render-as-you-fetch/" class="css-1nubre7">http://www.ayqy.net/blog/render-as-you-fetch/</a>
<a href="https://reactjs.org/blog/2019/11/06/building-great-user-experiences-with-concurrent-mode-and-suspense.html" class="css-1nubre7">https://reactjs.org/blog/2019/11/06/building-great-user-experiences-with-concurrent-mode-and-suspense.html</a>
<a href="https://dev.to/davidkpiano/you-don-t-need-a-library-for-state-machines-k7h" class="css-1nubre7">https://dev.to/davidkpiano/you-don-t-need-a-library-for-state-machines-k7h</a>
<a href="https://mp.weixin.qq.com/s/QeUwB_2mwhD4KWNyJsbojg" class="css-1nubre7">https://mp.weixin.qq.com/s/QeUwB_2mwhD4KWNyJsbojg</a>
<a href="https://redux.js.org/style-guide/style-guide/#treat-reducers-as-state-machines" class="css-1nubre7">https://redux.js.org/style-guide/style-guide/#treat-reducers-as-state-machines</a>
<a href="https://statecharts.dev/state-machine-state-explosion.html" class="css-1nubre7">https://statecharts.dev/state-machine-state-explosion.html</a>
<a href="http://realfiction.net/2019/01/30/xstate-a-typescript-state-machine-with-a-lot-of-features" class="css-1nubre7">http://realfiction.net/2019/01/30/xstate-a-typescript-state-machine-with-a-lot-of-features</a>
<a href="https://xstate-catalogue.com/" class="css-1nubre7">https://xstate-catalogue.com/</a>
<a href="https://stately.ai/viz" class="css-1nubre7">https://stately.ai/viz</a>
<a href="https://xstate.js.org/docs/about/resources.html" class="css-1nubre7">https://xstate.js.org/docs/about/resources.html</a>
<a href="https://xstate.js.org/docs/" class="css-1nubre7">https://xstate.js.org/docs/</a>
<a href="https://stately.ai/viz/33fd92e1-f9e6-49e6-bdeb-cef9e60195ec" class="css-1nubre7">https://stately.ai/viz/33fd92e1-f9e6-49e6-bdeb-cef9e60195ec</a></p><h3 id="video-material" class="css-17gfwuz"><a href="#video-material" aria-label="Video Material:" class="css-yixlj4"><svg viewBox="0 0 16 16" width="16" height="16" fill="currentcolor" aria-hidden="true"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Video Material:</h3></section></article></main><style data-emotion="css 1i8tjli">.css-1i8tjli{margin-top:32px;padding-top:16px;}</style><footer class="css-1i8tjli"><style data-emotion="css 1mbou4u">.css-1mbou4u{border-color:var(--theme-ui-colors-muted);}</style><hr class="css-1mbou4u"/><style data-emotion="css j6r63x">.css-j6r63x{margin-bottom:32px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><style data-emotion="css 95weix">.css-95weix{box-sizing:border-box;margin:0;min-width:0;display:-webkit-box;display:-webkit-flex;display:-ms-flexbox;display:flex;margin-bottom:32px;-webkit-align-items:center;-webkit-box-align:center;-ms-flex-align:center;align-items:center;}</style><div class="css-95weix"><style data-emotion="css 1emx3y6">.css-1emx3y6{margin-right:8px;margin-bottom:0;width:48px;min-width:48px;border-radius:99999px;}</style><div data-gatsby-image-wrapper="" style="width:48px;height:48px" class="gatsby-image-wrapper css-1emx3y6"><div aria-hidden="true" data-placeholder-image="" style="opacity:1;transition:opacity 500ms linear;background-color:#f8f8f8;width:48px;height:48px;position:relative"></div><picture><source type="image/webp" data-srcset="/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/e78b1/avatar.webp 48w,/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/8ef24/avatar.webp 96w" sizes="48px"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="48px" decoding="async" loading="lazy" data-src="/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/fcdb9/avatar.png" data-srcset="/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/fcdb9/avatar.png 48w,/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/e3fe2/avatar.png 96w" alt="Hchyeria"/></picture><noscript><picture><source type="image/webp" srcSet="/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/e78b1/avatar.webp 48w,/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/8ef24/avatar.webp 96w" sizes="48px"/><img data-gatsby-image-ssr="" data-main-image="" style="opacity:0" sizes="48px" decoding="async" loading="lazy" src="/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/fcdb9/avatar.png" srcSet="/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/fcdb9/avatar.png 48w,/tech-share/static/4bb07c9873a116f1b552fac08ba75ee7/e3fe2/avatar.png 96w" alt="Hchyeria"/></picture></noscript><script type="module">const t="undefined"!=typeof HTMLImageElement&&"loading"in HTMLImageElement.prototype;if(t){const t=document.querySelectorAll("img[data-main-image]");for(let e of t){e.dataset.src&&(e.setAttribute("src",e.dataset.src),e.removeAttribute("data-src")),e.dataset.srcset&&(e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset"));const t=e.parentNode.querySelectorAll("source[data-srcset]");for(let e of t)e.setAttribute("srcset",e.dataset.srcset),e.removeAttribute("data-srcset");e.complete&&(e.style.opacity=1)}}</script></div><div class="css-0">This is <style data-emotion="css 1xfcqgg">.css-1xfcqgg{color:var(--theme-ui-colors-primary);}</style><a href="https://github.com/Hchyeria" class="css-1xfcqgg">Hchyeria</a>.<br/>Learning can be fun.</div></div></footer></div></div></div></div><div id="gatsby-announcer" style="position:absolute;top:0;width:1px;height:1px;padding:0;overflow:hidden;clip:rect(0, 0, 0, 0);white-space:nowrap;border:0" aria-live="assertive" aria-atomic="true"></div></div><script id="gatsby-script-loader">/*<![CDATA[*/window.pagePath="/XState/";/*]]>*/</script><script id="gatsby-chunk-mapping">/*<![CDATA[*/window.___chunkMapping={"polyfill":["/polyfill-6393f989dd0a25e1f369.js"],"app":["/app-0757bd07aa19d9a578e2.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-1634ccf660e032cc27bb.js"],"component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js":["/component---node-modules-gatsby-theme-blog-core-src-templates-posts-query-js-6df640851470c17de6fd.js"]};/*]]>*/</script><script src="/tech-share/polyfill-6393f989dd0a25e1f369.js" nomodule=""></script><script src="/tech-share/component---node-modules-gatsby-theme-blog-core-src-templates-post-query-js-1634ccf660e032cc27bb.js" async=""></script><script src="/tech-share/commons-336c928a835dd092a474.js" async=""></script><script src="/tech-share/app-0757bd07aa19d9a578e2.js" async=""></script><script src="/tech-share/framework-50e1fed84a2b384cae09.js" async=""></script><script src="/tech-share/webpack-runtime-0d982ec01d78325662b2.js" async=""></script></body></html>